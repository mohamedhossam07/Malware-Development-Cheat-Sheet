#include <windows.h>
#include <iostream>
#include <string>

using namespace std;

int main(){


string dllpath = "C:\\injected.dll";
char dll[sizeof(dllpath)];
	int i;
	for (i = 0; i < sizeof(dllpath); i++) {
		dll[i] = dllpath[i];
	}

int pid;
cout << "Enter PID : ";
cin >> pid;
int tid;
cout << "Enter TID : ";
cin >> tid;

// accessing the targeted process and thread
HANDLE phandle = OpenProcess(PROCESS_ALL_ACCESS , false ,pid);
HANDLE thandle = OpenThread(THREAD_ALL_ACCESS, false , tid);

// allocating memory and write dll path into it
LPVOID pbase = VirtualAllocEx(phandle, NULL, sizeof(dll), MEM_COMMIT, PAGE_EXECUTE_READ);
WriteProcessMemory(phandle, pbase, dll, sizeof(dll), NULL);

// loading the dll to the APC queue
QueueUserAPC((PAPCFUNC) GetProcAddress(GetModuleHandle("Kernel32.dll"),"LoadLibraryA"), thandle, (ULONG_PTR)pbase );
return 0;
}
